<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Barkod Studio Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/241/241528.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>

    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <style>
        #barcode-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ffffff;
            padding: 24px;
            border-radius: 1.5rem;
        }
        svg { width: 100%; max-width: 280px; height: auto; }
        body { transition: background-color 0.3s ease; }
        input { font-size: 16px !important; }
        #pwa-install {
            display: none;
            position: fixed;
            top: 20px;
            background: #2563eb;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
            z-index: 100;
        }
        #reader {
            width: 100%;
            border-radius: 1.5rem;
            overflow: hidden;
            display: none;
        }
        .footer-text {
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            font-weight: 800;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen flex flex-col items-center justify-center p-4 pb-8">

    <button id="pwa-install">UygulamayÄ± YÃ¼kle</button>

    <div class="w-full max-w-sm bg-white dark:bg-slate-900 rounded-[2.5rem] shadow-2xl p-8 space-y-6 border border-slate-100 dark:border-slate-800 transition-all relative mb-8">
        
        <div class="flex justify-between items-center mb-2">
            <h1 class="text-xl font-black text-blue-600 dark:text-blue-400 tracking-tighter uppercase">Barkod Studio Pro</h1>
            <button onclick="toggleDarkMode()" class="p-2 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 active:scale-90 transition-all">
                <span id="theme-icon" class="text-lg">ðŸŒ™</span>
            </button>
        </div>

        <div id="barcode-container" class="shadow-inner border border-slate-50">
            <svg id="barcode"></svg>
        </div>

        <div class="space-y-4">
            <div id="reader" class="shadow-lg border-2 border-blue-500"></div>
            <div id="camera-error" class="text-red-500 text-xs text-center hidden">Kamera hatasÄ±! Ä°zinleri kontrol edin.</div>

            <div class="space-y-2">
                <label class="block text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-[0.2em] ml-1">Barkod Ä°Ã§eriÄŸi</label>
                <div class="relative flex items-center">
                    <input type="text" id="barcodeValue" value="KOD-12345" 
                        class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-2xl p-5 pr-20 text-lg font-bold outline-none focus:ring-4 focus:ring-blue-500/10 transition-all dark:text-white uppercase"
                        oninput="generateBarcode()">
                    
                    <button onclick="startCameraScan()" id="scanBtn" class="absolute right-2 bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 font-bold p-3 rounded-xl shadow-sm border border-slate-200 dark:border-slate-600 active:scale-90 transition-all flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
                        </svg>                          
                    </button>
                </div>
            </div>

            <div class="flex flex-col gap-3 pt-2">
                <button onclick="downloadPNG()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-5 rounded-2xl shadow-lg shadow-blue-200 dark:shadow-none active:scale-95 transition-all flex items-center justify-center gap-2">
                    PNG OLARAK KAYDET
                </button>
                
                <button onclick="clearInput()" class="w-full text-slate-400 dark:text-slate-500 font-bold py-2 rounded-2xl hover:text-red-500 transition-all text-[10px] uppercase tracking-widest">
                    TEMÄ°ZLE
                </button>
            </div>
        </div>
    </div>

    <footer class="footer-text text-slate-400 dark:text-slate-600">
        GURSES TEKNOLOJÄ°
    </footer>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js');
            });
        }

        let deferredPrompt;
        const installBtn = document.getElementById('pwa-install');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block';
        });

        installBtn.addEventListener('click', () => {
            installBtn.style.display = 'none';
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                deferredPrompt = null;
            });
        });

        function toggleDarkMode() {
            const html = document.documentElement;
            const icon = document.getElementById('theme-icon');
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                icon.innerText = 'ðŸŒ™';
                localStorage.theme = 'light';
            } else {
                html.classList.add('dark');
                icon.innerText = 'â˜€ï¸';
                localStorage.theme = 'dark';
            }
        }

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            document.getElementById('theme-icon').innerText = 'â˜€ï¸';
        }

        function generateBarcode() {
            const val = document.getElementById("barcodeValue").value;
            if (!val.trim()) { document.getElementById("barcode").innerHTML = ""; return; }
            try {
                JsBarcode("#barcode", val, {
                    format: "CODE128", width: 2, height: 100, displayValue: true, fontSize: 20, fontOptions: "bold", margin: 10, lineColor: "#000000", background: "#ffffff"
                });
            } catch (e) { }
        }

        let html5QrCode;
        let isScanning = false;

        function startCameraScan() {
            if (isScanning) { stopCameraScan(); return; }
            document.getElementById('reader').style.display = 'block';
            document.getElementById('camera-error').classList.add('hidden');
            isScanning = true;
            html5QrCode = new Html5Qrcode("reader");
            const config = { fps: 10, qrbox: { width: 250, height: 150 } };
            html5QrCode.start({ facingMode: "environment" }, config, 
                (decodedText) => {
                    document.getElementById("barcodeValue").value = decodedText;
                    generateBarcode();
                    stopCameraScan();
                }
            ).catch((err) => {
                isScanning = false;
                document.getElementById('reader').style.display = 'none';
                document.getElementById('camera-error').classList.remove('hidden');
            });
        }

        function stopCameraScan() {
            if (html5QrCode && isScanning) {
                html5QrCode.stop().then(() => {
                    document.getElementById('reader').style.display = 'none';
                    isScanning = false;
                });
            }
        }

        function clearInput() {
            document.getElementById("barcodeValue").value = "";
            document.getElementById("barcode").innerHTML = "";
        }

        function downloadPNG() {
            const svg = document.querySelector("#barcode");
            if (!svg.innerHTML) return;
            const svgData = new XMLSerializer().serializeToString(svg);
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const img = new Image();
            img.onload = function() {
                canvas.width = img.width + 60; canvas.height = img.height + 60;
                ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 30, 30);
                const link = document.createElement("a");
                link.download = `barkod-${Date.now()}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            };
            img.src = "data:image/svg+xml;base64," + btoa(unescape(encodeURIComponent(svgData)));
        }

        window.onload = generateBarcode;
    </script>
</body>
</html>
